name: Firestore Catalogue Upload

on:
  workflow_dispatch:

jobs:
  upload:
    runs-on: ubuntu-latest

    permissions:
      contents: read
      id-token: write

    steps:
      - name: Authenticate to Google Cloud
        id: auth
        uses: google-github-actions/auth@v2
        with:
          credentials_json: ${{ secrets.GCP_SA_KEY }}
          token_format: access_token

      # -----------------------------
      # STEP 1: CREATE DOCUMENT (POST)
      # -----------------------------
      - name: Create Firestore document (core entry)
        run: |
          curl -s -o /dev/null -w "%{http_code}" -X POST \
          "https://firestore.googleapis.com/v1/projects/site-9686c/databases/(default)/documents/Catalogue?documentId=Moto%20G60" \
          -H "Authorization: Bearer ${{ steps.auth.outputs.access_token }}" \
          -H "Content-Type: application/json" \
          -d '{
            "fields":{"model":{"stringValue":"Motorola Edge 50 Pro"},"architecture":{"stringValue":"64-bit"},"aspectRatio":{"stringValue":"20:9"},"audioFeatures":{"stringValue":"Stereo speakers, Dolby Atmos, Hi-Res Audio"},"audioJack":{"stringValue":"None"},"availableStorage":{"stringValue":"128GB/256GB/512GB"},"battery":{"stringValue":"Spec Score: 88%"},"batteryCapacity":{"stringValue":"5000 mAh"},"batteryRemovable":{"stringValue":"No"},"batteryTalkTime":{"stringValue":"Up to 20 hours (mixed usage)"},"batteryType":{"stringValue":"Li-Po"},"benchMarks":{"stringValue":"Antutu: 1,050,000; Geekbench: 2,300 (Single-Core), 9,500 (Multi-Core)"},"bezelLessDisplay":{"stringValue":"Yes, with punch‑hole camera"},"bluetooth":{"stringValue":"5.3"},"chipset":{"stringValue":"Qualcomm Snapdragon 8 Gen 3"},"colours":{"stringValue":"Obsidian Black, Aurora Blue, Sunset Red, Metallic Silver"},"comparePrices":{"stringValue":"Cheapest recorded price: ₹49,999"},"cpu":{"stringValue":"Octa-core (1x3.2 GHz Cortex-X4 + 3x2.8 GHz Cortex-A720 + 4x2.0 GHz Cortex-A520), Spec Score: 92%"},"customUi":{"stringValue":"Motorola UI 5.0 (Android 15)"},"dimensions":{"stringValue":"162.5 x 73.2 x 8.1 mm"},"displayType":{"stringValue":"Fluid AMOLED, 144Hz, HDR10+"},"expandable":{"stringValue":"No"},"expertRating":{"stringValue":"8.5/10 – The Motorola Edge 50 Pro delivers a compelling blend of flagship performance, a vibrant 144 Hz Fluid AMOLED display, and solid battery life, all wrapped in a sleek design. Its Snapdragon 8 Gen 3 chipset ensures smooth multitasking and gaming, while the camera system offers versatile shooting options. The lack of a headphone jack and limited storage expansion may deter some, but overall it stands out as a strong contender in the premium segment."}}
          }' || true

      # --------------------------------
      # STEP 2: ENRICH DOCUMENT (PATCH)
      # --------------------------------
      
