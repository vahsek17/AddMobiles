name: Firestore Catalogue Upload

on:
  workflow_dispatch:

jobs:
  upload:
    runs-on: ubuntu-latest

    permissions:
      contents: read
      id-token: write

    steps:
      - name: Authenticate to Google Cloud
        id: auth
        uses: google-github-actions/auth@v2
        with:
          credentials_json: ${{ secrets.GCP_SA_KEY }}
          token_format: access_token

      # -----------------------------
      # STEP 1: CREATE DOCUMENT (POST)
      # -----------------------------
      - name: Create Firestore document (core entry)
        run: |
          curl -s -o /dev/null -w "%{http_code}" -X POST \
          "https://firestore.googleapis.com/v1/projects/site-9686c/databases/(default)/documents/Catalogue?documentId=Moto4270" \
          -H "Authorization: Bearer ${{ steps.auth.outputs.access_token }}" \
          -H "Content-Type: application/json" \
          -d '{
            "fields": {"model":{"stringValue":"Motorola Edge 30 Ultra"},"architecture":{"stringValue":"64-bit, 4nm"},"aspectRatio":{"stringValue":"20:9"},"audioFeatures":{"stringValue":"24-bit/192kHz audio, Dolby Atmos"},"audioJack":{"stringValue":"No"},"availableStorage":{"stringValue":"128GB, 256GB, 512GB"},"battery":{"stringValue":"Spec Score: 92%"},"batteryCapacity":{"stringValue":"4610mAh"},"batteryRemovable":{"stringValue":"No"},"batteryTalkTime":{"stringValue":"Up to 24 Hours (4G)"},"batteryType":{"stringValue":"Li-Po"},"benchMarks":{"stringValue":"Geekbench: 1248 (single-core), 3955 (multi-core), AnTuTu: 621121"},"bezelLessDisplay":{"stringValue":"Punch-hole design"},"bluetooth":{"stringValue":"V5.2"},"chipset":{"stringValue":"Qualcomm Snapdragon 8+ Gen 1"},"colours":{"stringValue":"Interstellar Black, Starlight White, Aurora Green"},"comparePrices":{"stringValue":"INR 59,999"},"cpu":{"stringValue":"Octa-core (1x Cortex-X2, 3x Cortex-A710, 4x Cortex-A510), Spec Score: 95%"},"customUi":{"stringValue":"MyUX"},"dimensions":{"stringValue":"161.8 x 73.5 x 8.5 mm"},"displayType":{"stringValue":"AMOLED, HDR10+"},"expandable":{"stringValue":"Yes, up to 1TB"},"expertRating":{"stringValue":"9.1/10"},"fingerprintType":{"stringValue":"Optical"},"fingerprintPosition":{"stringValue":"Under display"},"fingerprintSensor":{"stringValue":"Yes"},"fmRadio":{"stringValue":"Yes"},"frontAutofocus":{"stringValue":"Yes"},"frontCamera":{"stringValue":"60MP, Spec Score: 91%"},"frontCameraSetup":{"stringValue":"Single camera 60MP, Spec Score: 91%"},"frontFlash":{"stringValue":"No"},"frontResolution":{"stringValue":"60MP f/2.2, Wide Angle, Primary Camera"},"frontVideo":{"stringValue":"4K@30fps, 1080p@30/60/120fps"},"gps":{"stringValue":"Yes with A-GPS, GLONASS, GALILEO, BDS"},"graphics":{"stringValue":"Adreno 730"},"hdr":{"stringValue":"Yes"},"imageURL":{"stringValue":"https://example.com/motorola-edge-30-ultra.jpg"},"internalMemory":{"stringValue":"128GB, 256GB, 512GB"},"launchDate":{"stringValue":"September 2022"},"loudSpeaker":{"stringValue":"Yes, stereo speakers"},"material":{"stringValue":"Glass back, Aluminum frame, Gorilla Glass Victus"},"networkSupport":{"stringValue":"5G, 4G, VoLTE, 3G, 2G"},"nfc":{"stringValue":"Yes"},"operatingSystem":{"stringValue":"Android 12, 3 years of software updates"},"otg":{"stringValue":"Yes"},"otherSensors":{"stringValue":"Proximity sensor, Accelerometer, Compass, Gyroscope, Heart rate sensor"},"peakBrightness":{"stringValue":"1300 nits"},"performance":{"stringValue":"Qualcomm Snapdragon 8+ Gen 1, Spec Score: 95%"},"pixelDensity":{"stringValue":"402 ppi"},"priceList":{"stringValue":"INR 59,999 (Flipkart), INR 60,999 (Amazon)"},"quickCharging":{"stringValue":"125W Fast Charging, 100% in 17 minutes"},"ram":{"stringValue":"8GB, 12GB, LPDDR5, Spec Score: 90%"},"rearAutoFocus":{"stringValue":"Yes"},"rearCamera":{"stringValue":"Spec Score: 94%"},"rearCameraFeatures":{"stringValue":"Auto flash, face detection, Touch to Focus, OIS"},"rearCameraSetup":{"stringValue":"Quad camera 200MP + 50MP (ultra-wide) + 12MP (telephoto) + 2MP (depth), Spec Score: 92%"},"rearFlash":{"stringValue":"Yes, LED flash"},"rearImageResolution":{"stringValue":"8000 x 6000 pixels"},"rearOis":{"stringValue":"Yes"},"rearResolution":{"stringValue":"200MP f/1.9, Wide Angle, Primary Camera"},"rearSettings":{"stringValue":"ISO control, Exposure compensation"},"rearShootingModes":{"stringValue":"Continuous Shooting, High Dynamic Range mode (HDR)"},"rearVideoFeatures":{"stringValue":"Dual Video Recording, Slo-motion, time lapse"},"rearVideoRecording":{"stringValue":"8K@30fps, 4K@30/60fps, 1080p@30/60/120/240fps"},"refreshRate":{"stringValue":"144Hz"},"resolution":{"stringValue":"1080 x 2400 pixels"},"ruggedness":{"stringValue":"IP52, dust and splash resistant"},"sar":{"stringValue":"Head: 1.19 W/kg, Body: 1.15 W/kg"},"screenProtection":{"stringValue":"Corning Gorilla Glass Victus"},"screenSize":{"stringValue":"6.67 inches"},"screenToBodyRatio":{"stringValue":"89.5%"},"sim1":{"stringValue":"5G, 4G, 3G, 2G, LTE band 1,2,3,4,5,7,8,12,13,17,18,19,20,25,26,28,29,30,32,34,38,39,40,41,42,43,46,48,66,71"},"sim2":{"stringValue":"5G, 4G, 3G, 2G, LTE band 1,2,3,4,5,7,8,12,13,17,18,19,20,25,26,28,29,30,32,34,38,39,40,41,42,43,46,48,66,71"},"simSize":{"stringValue":"Nano-SIM, Nano-SIM"},"simSlot":{"stringValue":"Dual SIM, GSM+GSM"},"stereoSpeakers":{"stringValue":"Yes"},"storage":{"stringValue":"Spec Score: 88%"},"touchScreen":{"stringValue":"Capacitive Touchscreen, Multi-touch"},"usbConnectivity":{"stringValue":"USB Type-C, USB 3.1, 10 Gbps"},"usbType":{"stringValue":"Type-C to Type-C"},"userRatings":{"stringValue":"4.6/5 based on 10210 ratings"},"voLte":{"stringValue":"Yes"},"waterproofing":{"stringValue":"Yes, IP52, dust and splash resistant"},"weight":{"stringValue":"188g"},"wifi":{"stringValue":"Wi-Fi 802.11, a/b/g/n/ac/ax, 2.4GHz, 5GHz"},"wifiFeatures":{"stringValue":"Mobile Hotspot, Wi-Fi Direct"}}
          }' || true

      # --------------------------------
      # STEP 2: ENRICH DOCUMENT (PATCH)
      # --------------------------------
      
