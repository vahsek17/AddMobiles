name: Firestore Catalogue Upload

on:
  workflow_dispatch:

jobs:
  upload:
    runs-on: ubuntu-latest

    permissions:
      contents: read
      id-token: write

    steps:
      - name: Authenticate to Google Cloud
        id: auth
        uses: google-github-actions/auth@v2
        with:
          credentials_json: ${{ secrets.GCP_SA_KEY }}
          token_format: access_token

      # -----------------------------
      # STEP 1: CREATE DOCUMENT (POST)
      # -----------------------------
      - name: Create Firestore document (core entry)
        run: |
          curl -s -o /dev/null -w "%{http_code}" -X POST \
          "https://firestore.googleapis.com/v1/projects/site-9686c/databases/(default)/documents/Catalogue?documentId=Moto422" \
          -H "Authorization: Bearer ${{ steps.auth.outputs.access_token }}" \
          -H "Content-Type: application/json" \
          -d '{ 
            "fields": { "model": { "stringValue": "Motorola Edge 30 Ultra" }, "architecture": { "stringValue": "64-bit, Qualcomm Snapdragon 8+ Gen 1, 4nm" }, "aspectRatio": { "stringValue": "20:9" }, "audioFeatures": { "stringValue": "24-bit/192kHz audio, Dual speakers, Dolby Atmos" }, "audioJack": { "stringValue": "No" }, "availableStorage": { "stringValue": "128GB, 256GB, 512GB" }, "battery": { "stringValue": "Spec Score: 92%" }, "batteryCapacity": { "stringValue": "4610mAh" }, "batteryRemovable": { "stringValue": "No" }, "batteryTalkTime": { "stringValue": "Up to 36 Hours (4G)" }, "batteryType": { "stringValue": "Li-Po" }, "benchMarks": { "stringValue": "Geekbench: 1334 (single-core), 3813 (multi-core), AnTuTu: 956281" }, "bezelLessDisplay": { "stringValue": "Punch-hole design" }, "bluetooth": { "stringValue": "V5.3" }, "chipset": { "stringValue": "Qualcomm Snapdragon 8+ Gen 1" }, "colours": { "stringValue": "Interstellar Black, Starlight White, Aurora Green" }, "comparePrices": { "stringValue": "INR 54,999" }, "cpu": { "stringValue": "Octa core (3.2 GHz, Single core, Cortex-X2 + 2.75 GHz, Tri core, Cortex-A710 + 2.0 GHz, Quad core, Cortex-A510), Spec Score: 95%" }, "customUi": { "stringValue": "MyUX" }, "dimensions": { "stringValue": "161.2 * 73.5 * 8.1 mm" }, "displayType": { "stringValue": "AMOLED, HDR10+" }, "expandable": { "stringValue": "Yes" }, "fingerprintType": { "stringValue": "Optical" }, "fingerprintPosition": { "stringValue": "Under display" }, "fingerprintSensor": { "stringValue": "Yes" }, "fmRadio": { "stringValue": "Yes" }, "frontAutofocus": { "stringValue": "Yes" }, "frontCamera": { "stringValue": "50MP, OIS, Spec Score: 88%" }, "frontCameraSetup": { "stringValue": "Single camera 50MP, Spec Score: 88%" }, "frontFlash": { "stringValue": "No" }, "frontResolution": { "stringValue": "50MP f/2.2, Wide Angle, Primary Camera" }, "frontVideo": { "stringValue": "3840x2160 @ 30 fps, 1920x1080 @ 120 fps" }, "gps": { "stringValue": "Yes with A-GPS, Glonass" }, "graphics": { "stringValue": "Adreno 730" }, "hdr": { "stringValue": "Yes" }, "imageURL": { "stringValue": "https://example.com/motorola-edge-30-ultra.jpg" }, "internalMemory": { "stringValue": "128GB, 256GB, 512GB" }, "launchDate": { "stringValue": "September 2022" }, "loudSpeaker": { "stringValue": "Yes, Dual speakers" }, "material": { "stringValue": "Gorilla Glass Victus, Plastic frame" }, "networkSupport": { "stringValue": "5G, 4G, VoLTE, 3G, 2G" }, "nfc": { "stringValue": "Yes" }, "operatingSystem": { "stringValue": "Android 12, 3 years of software updates" }, "otg": { "stringValue": "Yes" }, "otherSensors": { "stringValue": "Proximity sensor, Accelerometer, Compass, Gyroscope" }, "peakBrightness": { "stringValue": "1250 nits" }, "performance": { "stringValue": "Qualcomm Snapdragon 8+ Gen 1, Spec Score: 95%" }, "pixelDensity": { "stringValue": "402 ppi" }, "priceList": { "stringValue": "INR 54,999 (Flipkart), INR 55,499 (Amazon)" }, "quickCharging": { "stringValue": "125W Fast Charging, 100% in 25 mins" }, "ram": { "stringValue": "8GB, 12GB, LPDDR5, Spec Score: 92%" }, "rearAutoFocus": { "stringValue": "Yes" }, "rearCamera": { "stringValue": "Spec Score: 94%" }, "rearCameraFeatures": { "stringValue": "Auto flash, face detection, Touch to Focus, OIS" }, "rearCameraSetup": { "stringValue": "Quad camera 200MP + 12MP (ultra-wide) + 50MP (telephoto) + 50MP (depth), Spec Score: 94%" }, "rearFlash": { "stringValue": "Yes, LED flash" }, "rearImageResolution": { "stringValue": "8000 x 6000 pixels" }, "rearOis": { "stringValue": "Yes" }, "rearResolution": { "stringValue": "200MP f/1.9, Wide Angle, Primary Camera" }, "rearSettings": { "stringValue": "ISO control, Exposure compensation" }, "rearShootingModes": { "stringValue": "Continuous Shooting, High Dynamic Range mode (HDR)" }, "rearVideoFeatures": { "stringValue": "Dual Video Recording, Slo-motion, time lapse" }, "rearVideoRecording": { "stringValue": "3840x2160 @ 60 fps, 1920x1080 @ 240 fps" }, "refreshRate": { "stringValue": "144 Hz" }, "resolution": { "stringValue": "1080 x 2400 pixels" }, "ruggedness": { "stringValue": "IP52" }, "sar": { "stringValue": "Head: 1.18 W/kg, Body: 1.15 W/kg" }, "screenProtection": { "stringValue": "Corning Gorilla Glass Victus" }, "voLte": { "stringValue": "Yes" }, "waterproofing": { "stringValue": "No" }, "weight": { "stringValue": "199g" }, "wifi": { "stringValue": "Yes, Wi-Fi 802.11, a/ac/ax/b/g/n/n 5GHz" }, "wifiFeatures": { "stringValue": "Mobile Hotspot, Wi-Fi Direct" }, "expertRating": { "stringValue": "9.0/10 - The Motorola Edge 50 Pro offers a premium design with a 6.7-inch OLED display, Snapdragon 8+ Gen 1 chipset, and excellent camera performance. Battery life is solid, and the software is near‑stock, though occasional bloat remains. Overall a strong flagship for its price." }, "sim1": { "stringValue": "5G Bands: FDD N1/N3/N5/N7/N28, TDD N38/N40/N41/N77/N78; 4G Bands: FD-LTE 1/2/3/4/5/7/8/12/13/14/17/20/28/66; 3G Bands: UMTS 1/2/5/8; 2G Bands: GSM 850/900/1800/1900; GPRS: Available, EDGE: Available" }, "sim2": { "stringValue": "5G Bands: FDD N1/N3/N5/N7/N28, TDD N38/N40/N41/N77/N78; 4G Bands: FD-LTE 1/2/3/4/5/7/8/12/13/14/17/20/28/66; 3G Bands: UMTS 1/2/5/8; 2G Bands: GSM 850/900/1800/1900; GPRS: Available, EDGE: Available" }, "screenSize": { "stringValue": "6.7 inches" }, "screenToBodyRatio": { "stringValue": "92.5%" }, "simSize": { "stringValue": "nano" }, "simSlot": { "stringValue": "Dual SIM (Nano‑SIM, eSIM)" }, "stereoSpeakers": { "stringValue": "Yes" }, "storage": { "stringValue": "Spec Score: 88%" }, "touchScreen": { "stringValue": "Capacitive Touchscreen, Multi‑touch" }, "usbConnectivity": { "stringValue": "USB Type‑C 3.2 (10 Gbps)" }, "usbType": { "stringValue": "Type C to Type C" }, "userRatings": { "stringValue": "4.5/5 (23,456 reviews)" } } 
            }' || true

      # --------------------------------
      # STEP 2: ENRICH DOCUMENT (PATCH)
      # --------------------------------
      
