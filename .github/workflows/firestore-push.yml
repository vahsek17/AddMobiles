name: Firestore Catalogue Upload

on:
  workflow_dispatch:

jobs:
  upload:
    runs-on: ubuntu-latest

    permissions:
      contents: read
      id-token: write

    steps:
      - name: Authenticate to Google Cloud
        id: auth
        uses: google-github-actions/auth@v2
        with:
          credentials_json: ${{ secrets.GCP_SA_KEY }}
          token_format: access_token

      # -----------------------------
      # STEP 1: CREATE DOCUMENT (POST)
      # -----------------------------
      - name: Create Firestore document (core entry)
        run: |
          curl -s -o /dev/null -w "%{http_code}" -X POST \
          "https://firestore.googleapis.com/v1/projects/site-9686c/databases/(default)/documents/Catalogue?documentId=Moto%20G60" \
          -H "Authorization: Bearer ${{ steps.auth.outputs.access_token }}" \
          -H "Content-Type: application/json" \
          -d '{
            "fields":{"model":{"stringValue":"Motorola Edge 50"},"architecture":{"stringValue":"ARMv9"},"aspectRatio":{"stringValue":"20:9"},"audioFeatures":{"stringValue":"Stereo speakers, Dolby Atmos"},"audioJack":{"stringValue":"No"},"availableStorage":{"stringValue":"128 GB, 256 GB"},"battery":{"stringValue":"Li-Po"},"batteryCapacity":{"stringValue":"5000 mAh"},"batteryRemovable":{"stringValue":"No"},"batteryTalkTime":{"stringValue":"Up to 20 hours talk time"},"batteryType":{"stringValue":"Non-removable"},"benchMarks":{"stringValue":"Spec Score: 85%"},"bezelLessDisplay":{"stringValue":"Yes"},"bluetooth":{"stringValue":"5.3"},"chipset":{"stringValue":"Qualcomm Snapdragon 8+ Gen 2"},"colours":{"stringValue":"Obsidian Black, Sapphire Blue, Sunset Red"},"comparePrices":{"stringValue":"Price: $799 (128GB), $899 (256GB)"},"cpu":{"stringValue":"Octa-core (1x3.2 GHz Cortex-X3 & 3x2.8 GHz Cortex-A715 & 4x2.0 GHz Cortex-A510)"},"customUi":{"stringValue":"Motorola UI 5.0"},"dimensions":{"stringValue":"162.9 x 74.9 x 8.2 mm"},"displayType":{"stringValue":"AMOLED"},"expandable":{"stringValue":"No"},"expertRating":{"stringValue":"4.5/5 based on 15k ratings"},"fingerprintPosition":{"stringValue":"Side-mounted"},"fingerprintSensor":{"stringValue":"Optical"},"fingerprintType":{"stringValue":"Side-mounted optical sensor"},"fmRadio":{"stringValue":"No"},"frontAutofocus":{"stringValue":"Yes"},"frontCamera":{"stringValue":"12 MP"},"frontCameraSetup":{"stringValue":"Single"},"frontFlash":{"stringValue":"Yes"},"frontResolution":{"stringValue":"12 MP, f/2.0"},"frontVideo":{"stringValue":"4K@30fps"},"gps":{"stringValue":"Yes, A-GPS, GLONASS, BDS, GALILEO"},"graphics":{"stringValue":"Adreno 770"},"hdr":{"stringValue":"HDR10+"},"imageURL":{"stringValue":"https://example.com/motorola-edge-50.jpg"},"internalMemory":{"stringValue":"128 GB, 256 GB"},"launchDate":{"stringValue":"2024-10-15"},"loudSpeaker":{"stringValue":"Yes"},"material":{"stringValue":"Aluminum frame, Gorilla Glass Victus 2"},"networkSupport":{"stringValue":"5G, 4G LTE, 3G, 2G"},"nfc":{"stringValue":"Yes"},"operatingSystem":{"stringValue":"Android 14"},"otg":{"stringValue":"Yes"},"otherSensors":{"stringValue":"Accelerometer, Gyroscope, Proximity, Compass, Barometer"},"peakBrightness":{"stringValue":"1500 nits"},"performance":{"stringValue":"High performance, gaming optimized"},"pixelDensity":{"stringValue":"425 ppi"},"priceList":{"stringValue":"$799 (128GB), $899 (256GB)"},"quickCharging":{"stringValue":"65W wired, 15W wireless"},"ram":{"stringValue":"8 GB, 12 GB"},"rearAutoFocus":{"stringValue":"Yes"},"rearCamera":{"stringValue":"50 MP"},"rearCameraFeatures":{"stringValue":"OIS, PDAF, Laser AF"},"rearCameraSetup":{"stringValue":"Triple (50 MP main, 12 MP ultra-wide, 8 MP macro)"},"rearFlash":{"stringValue":"LED"},"rearImageResolution":{"stringValue":"50 MP, f/1.8"},"rearOis":{"stringValue":"Yes"},"rearResolution":{"stringValue":"50 MP, 12 MP, 8 MP"},"rearSettings":{"stringValue":"Pro mode, Night mode, Portrait"},"rearShootingModes":{"stringValue":"Auto, Pro, Night, Portrait, Panorama"},"rearVideoFeatures":{"stringValue":"HDR video, Super Steady"},"rearVideoRecording":{"stringValue":"8K@24fps, 4K@60fps, 1080p@240fps"},"refreshRate":{"stringValue":"120 Hz"},"resolution":{"stringValue":"1080 x 2400 pixels"},"ruggedness":{"stringValue":"IP68 water and dust resistance"},"sar":{"stringValue":"0.95 W/kg (head), 0.85 W/kg (body)"},"screenProtection":{"stringValue":"Gorilla Glass Victus 2"},"screenSize":{"stringValue":"6.7 inches"},"screenToBodyRatio":{"stringValue":"92%"},"sim1":{"stringValue":"Nano-SIM"},"sim2":{"stringValue":"Nano-SIM"},"simSize":{"stringValue":"Nano"},"simSlot":{"stringValue":"Dual SIM (Hybrid) or Single SIM + eSIM"},"stereoSpeakers":{"stringValue":"Yes"},"storage":{"stringValue":"128 GB, 256 GB"},"touchScreen":{"stringValue":"Capacitive multi-touch"},"usbConnectivity":{"stringValue":"USB Type-C"},"usbType":{"stringValue":"USB 3.2 Gen 1"},"userRatings":{"stringValue":"4.6/5 based on 12k ratings"},"voLte":{"stringValue":"Yes"},"waterproofing":{"stringValue":"IP68"},"weight":{"stringValue":"190 g"},"wifi":{"stringValue":"Wi-Fi 6E"},"wifiFeatures":{"stringValue":"Dual-band, Wi-Fi Direct, Hotspot"}}
          }' || true

      # --------------------------------
      # STEP 2: ENRICH DOCUMENT (PATCH)
      # --------------------------------
      
