name: Firestore Catalogue Upload

on:
  workflow_dispatch:

jobs:
  upload:
    runs-on: ubuntu-latest

    permissions:
      contents: read
      id-token: write

    steps:
      - name: Authenticate to Google Cloud
        id: auth
        uses: google-github-actions/auth@v2
        with:
          credentials_json: ${{ secrets.GCP_SA_KEY }}
          token_format: access_token

      # -----------------------------
      # STEP 1: CREATE DOCUMENT (POST)
      # -----------------------------
      - name: Create Firestore document (core entry)
        run: |
          curl -s -o /dev/null -w "%{http_code}" -X POST \
          "https://firestore.googleapis.com/v1/projects/site-9686c/databases/(default)/documents/Catalogue?documentId=Moto%20G60" \
          -H "Authorization: Bearer ${{ steps.auth.outputs.access_token }}" \
          -H "Content-Type: application/json" \
          -d '{
            "fields":{"model":{"stringValue":"Motorola Edge 50 Pro"},"architecture":{"stringValue":"64 bit"},"aspectRatio":{"stringValue":"20:9"},"audioFeatures":{"stringValue":"Stereo speakers with Dolby Atmos"},"audioJack":{"stringValue":"No"},"availableStorage":{"stringValue":"128 GB, 256 GB"},"battery":{"stringValue":"Spec Score: 88%"},"batteryCapacity":{"stringValue":"5000 mAh"},"batteryRemovable":{"stringValue":"No"},"batteryTalkTime":{"stringValue":"Up to 28 hours talk time"},"batteryType":{"stringValue":"Li-Po"},"benchMarks":{"stringValue":"AnTuTu V9: 720,000"},"bezelLessDisplay":{"stringValue":"Yes, 1.5 mm side bezels"},"bluetooth":{"stringValue":"Bluetooth 5.3"},"chipset":{"stringValue":"Qualcomm Snapdragon 8 Gen 3"},"colours":{"stringValue":"Obsidian Black, Aurora Green, Sunset Red"},"comparePrices":{"stringValue":"Cheapest recorded price: $799"},"cpu":{"stringValue":"Octa-core (1x3.2 GHz Cortex-X4 + 3x2.8 GHz Cortex-A78 + 4x2.0 GHz Cortex-A55), Spec Score: 92%"},"customUi":{"stringValue":"Motorola UI 4.0 on Android 14"},"dimensions":{"stringValue":"162.5 x 73.2 x 8.4 mm"},"displayType":{"stringValue":"OLED, 144Hz, HDR10+"},"expandable":{"stringValue":"No"},"expertRating":{"stringValue":"8.5/10 â€“ The Edge 50 Pro delivers a premium experience with a bright OLED display, strong performance, and solid battery life, though the lack of a headphone jack may deter some."}}
          }' || true

      # --------------------------------
      # STEP 2: ENRICH DOCUMENT (PATCH)
      # --------------------------------
      
