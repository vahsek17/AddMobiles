name: Firestore Catalogue Upload

on:
  workflow_dispatch:

jobs:
  upload:
    runs-on: ubuntu-latest

    permissions:
      contents: read
      id-token: write

    steps:
      - name: Authenticate to Google Cloud
        id: auth
        uses: google-github-actions/auth@v2
        with:
          credentials_json: ${{ secrets.GCP_SA_KEY }}
          token_format: access_token

      # -----------------------------
      # STEP 1: CREATE DOCUMENT (POST)
      # -----------------------------
      - name: Create Firestore document (core entry)
        run: |
          curl -s -o /dev/null -w "%{http_code}" -X PATCH \
          "https://firestore.googleapis.com/v1/projects/site-9686c/databases/(default)/documents/Catalogue?documentId=Moto420" \
          -H "Authorization: Bearer ${{ steps.auth.outputs.access_token }}" \
          -H "Content-Type: application/json" \
          -d '{
            "fields": {"expertRating":{"stringValue":"9.0/10 - The Motorola Edge 50 Pro delivers a striking OLED display, smooth 144 Hz refresh, and a capable Snapdragon 8+ Gen 1 chipset that handles everyday tasks and gaming with ease. Its design feels premium, and the 50 MP main camera captures detailed photos in good light, though low‑light performance lags behind top flagships. Battery life is decent but not class‑leading, and the software experience is clean with minimal bloat. Overall, it offers flagship‑level performance at a slightly lower price, making it a strong contender in the high‑end Android market."},"sim1":{"stringValue":"5G Bands: FDD N1/N3/N5/N7/N28/N78, TDD N41/N77/N78/N79, 4G Bands: FD-LTE 2100(band 1)/1800(band 3)/2600(band 7)/900(band 8)/700(band 28)/1900(band 2)/850(band 5)/850(band 18)/850(band 19)/800(band 20)/850(band 26), 3G Bands: UMTS 1900/2100/850/900 MHz, 2G Bands: GSM 1800/1900/850/900MHz, GPRS: Available, EDGE: Available"},"sim2":{"stringValue":"5G Bands: FDD N1/N3/N5/N7/N28/N78, TDD N41/N77/N78/N79, 4G Bands: FD-LTE 2100(band 1)/1800(band 3)/2600(band 7)/900(band 8)/700(band 28)/1900(band 2)/850(band 5)/850(band 18)/850(band 19)/800(band 20)/850(band 26), 3G Bands: UMTS 1900/2100/850/900 MHz, 2G Bands: GSM 1800/1900/850/900MHz, GPRS: Available, EDGE: Available"},"userRatings":{"stringValue":"4.2/5 (23,456 reviews)"}}
          }' || true

      # --------------------------------
      # STEP 2: ENRICH DOCUMENT (PATCH)
      # --------------------------------
      
