name: Firestore Catalogue Upload

on:
  workflow_dispatch:

jobs:
  upload:
    runs-on: ubuntu-latest

    permissions:
      contents: read
      id-token: write

    steps:
      - name: Authenticate to Google Cloud
        id: auth
        uses: google-github-actions/auth@v2
        with:
          credentials_json: ${{ secrets.GCP_SA_KEY }}
          token_format: access_token

      # -----------------------------
      # STEP 1: CREATE DOCUMENT (POST)
      # -----------------------------
      - name: Create Firestore document (core entry)
        run: |
          curl -s -o /dev/null -w "%{http_code}" -X POST \
          "https://firestore.googleapis.com/v1/projects/site-9686c/databases/(default)/documents/Catalogue?documentId=Moto%20G60" \
          -H "Authorization: Bearer ${{ steps.auth.outputs.access_token }}" \
          -H "Content-Type: application/json" \
          -d '{
            "fields": {"model":{"stringValue":"Motorola Edge 30 Ultra"},"architecture":{"stringValue":"64-bit, Qualcomm Snapdragon 8+ Gen 1"},"aspectRatio":{"stringValue":"20:9"},"audioFeatures":{"stringValue":"24-bit/192kHz audio, Dolby Atmos"},"audioJack":{"stringValue":"No"},"availableStorage":{"stringValue":"128GB, 256GB, 512GB"},"battery":{"stringValue":"Spec Score: 92%"},"batteryCapacity":{"stringValue":"4610mAh"},"batteryRemovable":{"stringValue":"No"},"batteryTalkTime":{"stringValue":"Up to 36 Hours (4G)"},"batteryType":{"stringValue":"Li-Po"},"benchMarks":{"stringValue":"Geekbench: 1344 (single-core), 4281 (multi-core), AnTuTu: 1023211"},"bezelLessDisplay":{"stringValue":"Punch-hole"},"bluetooth":{"stringValue":"V5.2"},"chipset":{"stringValue":"Qualcomm Snapdragon 8+ Gen 1"},"colours":{"stringValue":"Interstellar Black, Starlight White, Aurora Green"},"comparePrices":{"stringValue":"INR 54,999"}}}
          }' || true

      # --------------------------------
      # STEP 2: ENRICH DOCUMENT (PATCH)
      # --------------------------------
      
