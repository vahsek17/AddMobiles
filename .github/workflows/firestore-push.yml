name: Firestore Catalogue Upload

on:
  workflow_dispatch:   # manual trigger from GitHub UI

jobs:
  upload:
    runs-on: ubuntu-latest

    permissions:
      contents: read
      id-token: write

    steps:
      - name: Authenticate to Google Cloud
        id: auth
        uses: google-github-actions/auth@v2
        with:
          credentials_json: ${{ secrets.GCP_SA_KEY }}
          token_format: access_token

      - name: Show full Bearer Token
        run: |
          echo "Access token:"
          echo "${{ steps.auth.outputs.access_token }}"

      - name: Create Firestore document
        run: |
          curl -X PATCH \
          "https://firestore.googleapis.com/v1/projects/site-9686c/databases/(default)/documents/Catalogue?documentId=Moto%20G60" \
          -H "Authorization: Bearer ${{ steps.auth.outputs.access_token }}" \
          -H "Content-Type: application/json" \
          -d '{
            "fields":{"rearCamera":{"stringValue":"50 MP primary sensor"},"rearCameraSetup":{"stringValue":"Triple camera: 50 MP main, 13 MP ultra-wide, 5 MP macro"},"rearCameraFeatures":{"stringValue":"OIS, PDAF, Laser AF, HDR, Night mode"},"rearAutoFocus":{"stringValue":"Phase detection and laser autofocus"},"rearOis":{"booleanValue":true},"rearFlash":{"stringValue":"LED dual-tone flash"},"rearResolution":{"stringValue":"50 MP"},"rearImageResolution":{"stringValue":"8192x6144"},"rearSettings":{"stringValue":"Pro mode, AI scene detection"},"rearShootingModes":{"stringValue":"Portrait, Night, Pro, Panorama"},"rearVideoRecording":{"stringValue":"8K@30fps, 4K@60fps"},"rearVideoFeatures":{"stringValue":"Super steady, HDR10+, slow motion"},"frontCamera":{"stringValue":"32 MP"},"frontCameraSetup":{"stringValue":"Single lens"},"frontAutofocus":{"booleanValue":true},"frontFlash":{"booleanValue":false},"frontResolution":{"stringValue":"32 MP"},"frontVideo":{"stringValue":"4K@30fps"},"hdr":{"booleanValue":true},"peakBrightness":{"integerValue":"1500"},"expertRating":{"stringValue":"9/10 - The Motorola Edge 50 Pro impresses with its 50â€¯MP main sensor, robust OIS, and smooth 8K video, while its sleek design and clean UI make it a strong flagship contender, though the battery life could be better."},"userRatings":{"stringValue":"4.6/5 (23,487 reviews)"},"benchMarks":{"stringValue":"AnTuTu 750k, Geekbench 5 (single 1400, multi 4500)"},"imageURL":{"stringValue":"https://example.com/motorola_edge_50_pro.jpg"},"loudSpeaker":{"booleanValue":true},"otherSensors":{"stringValue":"Fingerprint (under display), Accelerometer, Gyroscope, Proximity, Compass, Barometer"}}
          }'
