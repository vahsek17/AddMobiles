name: Firestore Catalogue Upload

on:
  workflow_dispatch:

jobs:
  upload:
    runs-on: ubuntu-latest

    permissions:
      contents: read
      id-token: write

    steps:
      - name: Authenticate to Google Cloud
        id: auth
        uses: google-github-actions/auth@v2
        with:
          credentials_json: ${{ secrets.GCP_SA_KEY }}
          token_format: access_token

      # -----------------------------
      # STEP 1: CREATE DOCUMENT (POST)
      # -----------------------------
      - name: Create Firestore document (core entry)
        run: |
          curl -s -o /dev/null -w "%{http_code}" -X POST \
          "https://firestore.googleapis.com/v1/projects/site-9686c/databases/(default)/documents/Catalogue?documentId=Moto%20G60" \
          -H "Authorization: Bearer ${{ steps.auth.outputs.access_token }}" \
          -H "Content-Type: application/json" \
          -d '{
            "fields": {"model":{"stringValue":"Moto G62 5G"},"architecture":{"stringValue":"64-bit, 6nm fabrication"},"aspectRatio":{"stringValue":"20:9"},"audioFeatures":{"stringValue":"24-bit/192kHz audio, Dolby Atmos"},"audioJack":{"stringValue":"Yes"},"availableStorage":{"stringValue":"64GB, 128GB"},"battery":{"stringValue":"Spec Score: 92%"},"batteryCapacity":{"stringValue":"5000mAh"},"batteryRemovable":{"stringValue":"No"},"batteryTalkTime":{"stringValue":"Up to 36 Hours (4G)"},"batteryType":{"stringValue":"Li-Po"},"benchMarks":{"stringValue":"Geekbench: 512 (single-core), 1521 (multi-core)"},"bezelLessDisplay":{"stringValue":"Punch-hole design"},"bluetooth":{"stringValue":"V5.1"},"chipset":{"stringValue":"Qualcomm Snapdragon 480+ 5G"},"colours":{"stringValue":"Green, Blue, Black"},"comparePrices":{"stringValue":"INR 17,999"},"cpu":{"stringValue":"Octa core (2.2 GHz, Dual core, Kryo 460 + 1.8 GHz, Hexa Core, Kryo 460), Spec Score: 85%"},"customUi":{"stringValue":"My UX"},"dimensions":{"stringValue":"165.1 mm * 75.8 mm * 8.2 mm"},"displayType":{"stringValue":"IPS LCD, HDR10"},"expandable":{"stringValue":"Yes"},"expertRating":{"stringValue":"8.5/10"},"fingerprintType":{"stringValue":"Optical"},"fingerprintPosition":{"stringValue":"Rear-mounted"},"fingerprintSensor":{"stringValue":"Yes"},"fmRadio":{"stringValue":"Yes"},"frontAutofocus":{"stringValue":"No"},"frontCamera":{"stringValue":"Spec Score: 80%"},"frontCameraSetup":{"stringValue":"Single camera 16 MP, Spec Score: 80%"},"frontFlash":{"stringValue":"No"},"frontResolution":{"stringValue":"16 MP f/2.2, Wide Angle, Primary Camera"},"frontVideo":{"stringValue":"1080p @ 30fps"},"gps":{"stringValue":"Yes with A-GPS, Glonass"},"graphics":{"stringValue":"Adreno 619"},"hdr":{"stringValue":"Yes"},"imageURL":{"stringValue":"https://example.com/moto-g62-5g.jpg"},"internalMemory":{"stringValue":"64GB, 128GB"},"launchDate":{"stringValue":"August 2022"},"loudSpeaker":{"stringValue":"Yes"},"material":{"stringValue":"Plastic back, Gorilla Glass 3 front"},"networkSupport":{"stringValue":"5G, 4G, VoLTE, 3G, 2G"},"nfc":{"stringValue":"Yes"},"operatingSystem":{"stringValue":"Android 12, 2 years of software updates"},"otg":{"stringValue":"Yes"},"otherSensors":{"stringValue":"Proximity sensor, Accelerometer, Compass, Gyroscope"},"peakBrightness":{"stringValue":"400 nits"},"performance":{"stringValue":"Qualcomm Snapdragon 480+ 5G, Spec Score: 80%"},"pixelDensity":{"stringValue":"405 ppi"},"priceList":{"stringValue":"INR 17,999 (Flipkart), INR 18,499 (Amazon)"},"quickCharging":{"stringValue":"30W Fast Charging, 100% in 60 mins"},"ram":{"stringValue":"4GB, 6GB, LPDDR4X, Spec Score: 80%"},"rearAutoFocus":{"stringValue":"Yes"},"rearCamera":{"stringValue":"Spec Score: 85%"},"rearCameraFeatures":{"stringValue":"Auto flash, face detection, Touch to Focus"},"rearCameraSetup":{"stringValue":"Triple camera 50 MP + 8 MP (ultra-wide) + 2 MP (macro), Spec Score: 85%"},"rearFlash":{"stringValue":"Yes"},"rearImageResolution":{"stringValue":"50 MP"},"rearOis":{"stringValue":"No"},"rearResolution":{"stringValue":"50 MP f/1.8, Wide Angle, Primary Camera"},"rearSettings":{"stringValue":"None"},"rearShootingModes":{"stringValue":"Continuous Shooting, High Dynamic Range mode (HDR)"},"rearVideoFeatures":{"stringValue":"Dual Video Recording, Slo-motion, time lapse"},"rearVideoRecording":{"stringValue":"4K @ 30fps, 1080p @ 60fps"},"refreshRate":{"stringValue":"90Hz"},"resolution":{"stringValue":"1080 x 2400 pixels"},"ruggedness":{"stringValue":"None"},"sar":{"stringValue":"Head: 1.18 W/kg, Body: 1.15 W/kg"},"screenProtection":{"stringValue":"Gorilla Glass 3"},"screenSize":{"stringValue":"6.5 inches"},"screenToBodyRatio":{"stringValue":"85.4%"},"sim1":{"stringValue":"GSM, 4G, VoLTE, 3G, 2G, 5G"},"sim2":{"stringValue":"GSM, 4G, VoLTE, 3G, 2G, 5G"},"simSize":{"stringValue":"Nano"},"simSlot":{"stringValue":"Dual SIM, GSM+GSM"},"stereoSpeakers":{"stringValue":"No"},"storage":{"stringValue":"Spec Score: 80%"},"touchScreen":{"stringValue":"Capacitive Touchscreen, Multi-touch"},"usbConnectivity":{"stringValue":"Type C 2.0 (10 Gbps)"},"usbType":{"stringValue":"Type C to Type C"},"userRatings":{"stringValue":"4.5/5 based on 1056 ratings"},"voLte":{"stringValue":"Yes"},"waterproofing":{"stringValue":"No"},"weight":{"stringValue":"185g"},"wifi":{"stringValue":"Yes, Wi-Fi 802.11, a/b/g/n"},"wifiFeatures":{"stringValue":"Mobile Hotspot"}}
          }' || true

      # --------------------------------
      # STEP 2: ENRICH DOCUMENT (PATCH)
      # --------------------------------
      
