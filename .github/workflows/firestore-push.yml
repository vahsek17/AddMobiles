name: Firestore Catalogue Upload

on:
  workflow_dispatch:

jobs:
  upload:
    runs-on: ubuntu-latest

    permissions:
      contents: read
      id-token: write

    steps:
      - name: Authenticate to Google Cloud
        id: auth
        uses: google-github-actions/auth@v2
        with:
          credentials_json: ${{ secrets.GCP_SA_KEY }}
          token_format: access_token

      # -----------------------------
      # STEP 1: CREATE DOCUMENT (POST)
      # -----------------------------
      - name: Create Firestore document (core entry)
        run: |
          curl -s -o /dev/null -w "%{http_code}" -X POST \
          "https://firestore.googleapis.com/v1/projects/site-9686c/databases/(default)/documents/Catalogue?documentId=Moto%20G60" \
          -H "Authorization: Bearer ${{ steps.auth.outputs.access_token }}" \
          -H "Content-Type: application/json" \
          -d '{
            "fields":{"model":{"stringValue":"Motorola Edge 40 Pro"},"architecture":{"stringValue":"ARMv9"},"aspectRatio":{"stringValue":"20:9"},"audioFeatures":{"stringValue":"Stereo speakers, Dolby Atmos"},"audioJack":{"stringValue":"No"},"availableStorage":{"stringValue":"256 GB"},"battery":{"stringValue":"5000 mAh"},"batteryCapacity":{"stringValue":"5000 mAh"},"batteryRemovable":{"stringValue":"No"},"batteryTalkTime":{"stringValue":"Up to 24 hours talk time"},"batteryType":{"stringValue":"Li-Po"},"benchMarks":{"stringValue":"Spec Score: 85%"},"bezelLessDisplay":{"stringValue":"Yes"},"bluetooth":{"stringValue":"Bluetooth 5.3"},"chipset":{"stringValue":"Qualcomm Snapdragon 8 Gen 3"},"colours":{"stringValue":"Obsidian Black, Aurora Green, Sapphire Blue"},"comparePrices":{"stringValue":"Price: $799 (USA), €749 (EU), ₹64,999 (India)"},"cpu":{"stringValue":"Octa-core (1x3.2 GHz Cortex-X4 & 3x2.8 GHz Cortex-A720 & 4x2.0 GHz Cortex-A520)"},"customUi":{"stringValue":"Motorola UI 5.0"},"dimensions":{"stringValue":"162.5 x 73.8 x 8.2 mm"},"displayType":{"stringValue":"AMOLED"},"expandable":{"stringValue":"No"},"expertRating":{"stringValue":"Spec Score: 85%"},"fingerprintPosition":{"stringValue":"Under display"},"fingerprintSensor":{"stringValue":"Optical"},"fingerprintType":{"stringValue":"Under-display optical"},"fmRadio":{"stringValue":"No"},"frontAutofocus":{"stringValue":"Yes"},"frontCamera":{"stringValue":"12 MP"},"frontCameraSetup":{"stringValue":"Single"},"frontFlash":{"stringValue":"Yes"},"frontResolution":{"stringValue":"12 MP"},"frontVideo":{"stringValue":"4K@30fps"},"gps":{"stringValue":"GPS, GLONASS, Galileo, BDS"},"graphics":{"stringValue":"Adreno 770"},"hdr":{"stringValue":"HDR10+"},"imageURL":{"stringValue":"https://example.com/motorola-edge-40-pro.jpg"},"internalMemory":{"stringValue":"256 GB"},"launchDate":{"stringValue":"September 2024"},"loudSpeaker":{"stringValue":"Stereo speakers"},"material":{"stringValue":"Aluminum frame, Gorilla Glass Victus 2"},"networkSupport":{"stringValue":"5G, 4G LTE, 3G, 2G"},"nfc":{"stringValue":"Yes"},"operatingSystem":{"stringValue":"Android 14"},"otg":{"stringValue":"Yes"},"otherSensors":{"stringValue":"Accelerometer, Gyroscope, Proximity, Ambient Light, Barometer"},"peakBrightness":{"stringValue":"1500 nits"},"performance":{"stringValue":"Spec Score: 85%"},"pixelDensity":{"stringValue":"425 ppi"},"priceList":{"stringValue":"$799 (US), €749 (EU), ₹64,999 (IN)"},"quickCharging":{"stringValue":"65W wired, 30W wireless"},"ram":{"stringValue":"12 GB"},"rearAutoFocus":{"stringValue":"Yes"},"rearCamera":{"stringValue":"50 MP"},"rearCameraFeatures":{"stringValue":"OIS, PDAF, Laser AF"},"rearCameraSetup":{"stringValue":"Triple (50 MP main, 12 MP ultra-wide, 8 MP telephoto)"},"rearFlash":{"stringValue":"LED flash"},"rearImageResolution":{"stringValue":"50 MP"},"rearOis":{"stringValue":"Yes"},"rearResolution":{"stringValue":"50 MP"},"rearSettings":{"stringValue":"Pro mode, Night mode, Portrait mode"},"rearShootingModes":{"stringValue":"Night, Portrait, Pro, Panorama"},"rearVideoFeatures":{"stringValue":"8K@24fps, 4K@60fps, HDR video"},"rearVideoRecording":{"stringValue":"8K@24fps, 4K@60fps"},"refreshRate":{"stringValue":"120 Hz"},"resolution":{"stringValue":"1080 x 2400 pixels"},"ruggedness":{"stringValue":"IP68 water and dust resistance"},"sar":{"stringValue":"0.99 W/kg (head), 0.85 W/kg (body)"},"screenProtection":{"stringValue":"Gorilla Glass Victus 2"},"screenSize":{"stringValue":"6.7 inches"},"screenToBodyRatio":{"stringValue":"92%"},"sim1":{"stringValue":"Nano-SIM"},"sim2":{"stringValue":"Nano-SIM"},"simSize":{"stringValue":"Nano"},"simSlot":{"stringValue":"Dual SIM (nano-SIM, dual stand-by)"},"stereoSpeakers":{"stringValue":"Yes"},"storage":{"stringValue":"256 GB"},"touchScreen":{"stringValue":"Capacitive multi-touch"},"usbConnectivity":{"stringValue":"USB Type-C"},"usbType":{"stringValue":"USB 3.2 Gen 1"},"userRatings":{"stringValue":"4.6/5 based on 12k ratings"},"voLte":{"stringValue":"Yes"}
          }' || true

      # --------------------------------
      # STEP 2: ENRICH DOCUMENT (PATCH)
      # --------------------------------
      
