name: Firestore Catalogue Upload

on:
  workflow_dispatch:

jobs:
  upload:
    runs-on: ubuntu-latest

    permissions:
      contents: read
      id-token: write

    steps:
      - name: Authenticate to Google Cloud
        id: auth
        uses: google-github-actions/auth@v2
        with:
          credentials_json: ${{ secrets.GCP_SA_KEY }}
          token_format: access_token

      # -----------------------------
      # STEP 1: CREATE DOCUMENT (POST)
      # -----------------------------
      - name: Create Firestore document (core entry)
        run: |
          curl -s -o /dev/null -w "%{http_code}" -X POST \
          "https://firestore.googleapis.com/v1/projects/site-9686c/databases/(default)/documents/Catalogue?documentId=Moto%20G60" \
          -H "Authorization: Bearer ${{ steps.auth.outputs.access_token }}" \
          -H "Content-Type: application/json" \
          -d '{
            "fields": {"model":"Motorola Edge 50","architecture":"6nm","aspectRatio":"20:9","audioFeatures":"Stereo speakers, Dolby Atmos","audioJack":"No","availableStorage":"128 GB, 256 GB","battery":"Li-Po","batteryCapacity":"5000 mAh","batteryRemovable":"No","batteryTalkTime":"Up to 28 hrs","batteryType":"Lithium Polymer","benchMarks":"AnTuTu 850,000","bezelLessDisplay":"Yes","bluetooth":"5.3","chipset":"Qualcomm Snapdragon 8 Gen 3","colours":"Obsidian Black, Aurora Blue, Sunset Red","comparePrices":"USD 799 vs Samsung Galaxy S24 999","cpu":"Octa-core (1x3.2GHz + 3x2.8GHz + 4x2.0GHz)","customUi":"Motorola UI 5.0","dimensions":"162.5 x 75.8 x 8.2 mm","displayType":"AMOLED","expandable":"No","expertRating":"Spec Score: 85%","fingerprintPosition":"Side-mounted","fingerprintSensor":"Optical","fingerprintType":"Capacitive","fmRadio":"No","frontAutofocus":"Yes","frontCamera":"50 MP","frontCameraSetup":"Single","frontFlash":"LED","frontResolution":"50 MP","frontVideo":"4K@30fps","gps":"Yes, A-GPS, GLONASS, BDS","graphics":"Adreno 770","hdr":"HDR10+","imageURL":"https://example.com/motorola_edge_50.jpg","internalMemory":"128 GB","launchDate":"September 2025","loudSpeaker":"Yes","material":"Aluminum frame, Gorilla Glass Victus 2","networkSupport":"5G, 4G LTE, 3G","nfc":"Yes","operatingSystem":"Android 14","otg":"Yes","otherSensors":"Accelerometer, Gyroscope, Proximity, Compass","peakBrightness":"1500 nits","performance":"High","pixelDensity":"425 ppi","priceList":"USD 799","quickCharging":"65W wired, 30W wireless","ram":"12 GB","rearAutoFocus":"Yes","rearCamera":"108 MP","rearCameraFeatures":"Laser AF, PDAF, OIS","rearCameraSetup":"Triple (108 MP main, 12 MP ultra-wide, 5 MP macro)","rearFlash":"Dual LED","rearImageResolution":"108 MP","rearOis":"Yes","rearResolution":"108 MP","rearSettings":"Pro mode, Night mode, Portrait","rearShootingModes":"Panorama, HDR, Super Slow-mo","rearVideoFeatures":"8K@30fps, 4K@60fps, HDR video","rearVideoRecording":"8K@30fps, 4K@60fps","refreshRate":"120Hz","resolution":"1440 x 3200","ruggedness":"IP68","sar":"0.95 W/kg","screenProtection":"Gorilla Glass Victus 2","screenSize":"6.7 inches","screenToBodyRatio":"92%","sim1":"Nano-SIM","sim2":"Nano-SIM","simSize":"Nano","simSlot":"Dual SIM (Hybrid)","stereoSpeakers":"Yes","storage":"128 GB, 256 GB","touchScreen":"Capacitive, 10-point","usbConnectivity":"Yes","usbType":"USB Type-C 3.2","userRatings":"4.6/5 based on 12k ratings","voLte":"Yes","waterproofing":"Yes, IP68","weight":"190 g","wifi":"Wi-Fi 6E","wifiFeatures":"Dual-band, Wi-Fi Direct, Hotspot"}
          }' || true

      # --------------------------------
      # STEP 2: ENRICH DOCUMENT (PATCH)
      # --------------------------------
      
