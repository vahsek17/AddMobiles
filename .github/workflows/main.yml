name: Groq Debug – Stepwise Output

on:
  workflow_dispatch:

jobs:
  groq-debug:
    runs-on: ubuntu-latest

    steps:
      # -----------------------------
      # STEP 1: BASE CATALOGUE CALL
      # -----------------------------
      - name: Groq Call 1 – Base catalogue
        run: |
          echo "===== CALL 1: RAW RESPONSE ====="
          RESPONSE_1=$(curl -s -X POST "https://api.groq.com/openai/v1/chat/completions" \
            -H "Authorization: Bearer ${{ secrets.GROQ_API_KEY }}" \
            -H "Content-Type: application/json" \
            -d '{
              "model": "groq/compound-mini",
              "messages": [
                {
                  "role": "user",
                  "content": "STRICT_MODE=TRUE; generate Motorola’s latest widely released smartphone as STRICT valid Firestore REST JSON ONLY; output exactly ONE JSON object in ONE single paragraph with NO line breaks; the ROOT object MUST contain ONLY the key '\''fields'\''; inside '\''fields'\'', EVERY attribute MUST be an object with a single key '\''stringValue'\''; DO NOT output raw strings; DO NOT use booleanValue, integerValue, or doubleValue"
                }
              ]
            }')

          echo "$RESPONSE_1"
          echo ""
          echo "===== CALL 1: MODEL CONTENT ONLY ====="
          echo "$RESPONSE_1" | jq -r '.choices[0].message.content'

      # -----------------------------
      # STEP 2: ENRICHMENT CALL
      # -----------------------------
      - name: Groq Call 2 – Enrichment data
        run: |
          echo "===== CALL 2: RAW RESPONSE ====="
          RESPONSE_2=$(curl -s -X POST "https://api.groq.com/openai/v1/chat/completions" \
            -H "Authorization: Bearer ${{ secrets.GROQ_API_KEY }}" \
            -H "Content-Type: application/json" \
            -d '{
              "model": "groq/compound-mini",
              "messages": [
                {
                  "role": "user",
                  "content": "STRICT_MODE=TRUE; generate Firestore REST JSON ONLY for Motorola Edge 50 Pro enrichment data; output exactly ONE JSON object in ONE single paragraph with NO line breaks; ROOT key '\''fields'\''; include ONLY the following keys in this EXACT ORDER: expertRating, sim1, sim2, userRatings; expertRating MUST include rating out of 10 plus a concise expert review under 180 words; userRatings MUST be out of 5 with realistic count under 50000"
                }
              ]
            }')

          echo "$RESPONSE_2"
          echo ""
          echo "===== CALL 2: MODEL CONTENT ONLY ====="
          echo "$RESPONSE_2" | jq -r '.choices[0].message.content'
